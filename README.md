## Программируемый дешифратор (MMU) для Пальмиры

Прототипом послужил программируемый дешифратор для Радио 86-РК, описанный в журналах "Радио" 1994, №3-5. Общая идея конструктива - плата программируемого дешифратора вставляется в сокет процессора, а процессор (возможно, в виде z80card) вставляется в панельку на плате ПД. Дополнительные сигналы к/от платы Пальмиры выводятся на штырьковый разъем на правом краю платы ПД.

Внесены следующие усовершенствования:

1. Устранена зависимость от значений системного регистра при программировании устройства по адресу 0FFh. В оригинальном устройстве запись по адресу 0FFh меняла и значение системного регистра, и ОЗУ дешифратора. Это налагало ограничение на значения, которые можно записать в порт 0FFh и усложняло программирование. Теперь эти порты схемотехнически разделены - если было предварительное чтение из порта 0FFh, запись будет в системный регистр, в противном случае - в ОЗУ дешифратора.
2. Используются все биты ОЗУ дешифратора, старшие 4 бита используются для расширения адреса системного ОЗУ. Поддерживается до 512К системного ОЗУ. Поддерживается 64 (максимум 128) кбайта ПЗУ.
3. Бит 4 ОЗУ дешифратора более не используется как признак "только чтение", вместо него используется значение 3 номера линии устройства.
4. Поддерживается бит 0 байта расширения конфигурации Пальмиры, включающий теневое ОЗУ по адресам 0-7FFFh.
5. Поддерживается до 4-х конфигураций дешифратора, которые выбираются битами 4-3 системного регистра. Таким образом, для того, чтобы изменить конфигурацию памяти, нет необходимости менять её постранично, можно запрограммировать новую конфигурацию заранее, а потом мгновенно применить её одной запись в порт 0FFh.
6. Поддерживается процессор Z80 в формате z80-card. 580ВМ80А также поддерживается, совместно с системным контроллером 580ВК38
7. Вместо микросхемы КР537РУ10 применена IDC6116SA45P как более быстродействующая, изменены тайминги сигнала записи в нее для повышения надежности записи.

## Системный регистр (in/out 0FFh)

|Бит|Биты управления режимом|
|-|-|
|7||
|6||
|5||
|4|Биты выбора конфигурации|
|3|Биты выбора конфигурации|
|2|свободно|
|1|свободно|
|0|свободно|

Чтобы записать в системный регистр, надо сначала из него прочитать. Первая запись после чтения по адресу 0FFh будет в системный регистр, все последующие - в ОЗУ дешифратора (в режиме программирования) или в порт в рабочем режиме.

## Назначение линий выхода дешифратора ИД3:

|Номер линии|Адрес в Пальмире|Устройство|
|-|-|-|
|0|0C200h|ВВ55 контроллер клавиатуры|
|1|0C400h|ВВ55 дополнительный контроллер|
|2|0C000h|ВГ75 контроллер дисплея|
|3|-|ОЗУ только чтение|
|4|0E000h|ПЗУ|
|5|0000h|ОЗУ первые 32кб|
|6|0CC00h|ВИ53-1|
|7|0C600h|ВТ57/ВТ37|
|8|0C800h|ВИ53-2|
|9|||
|10|0D800h|ОЗУ ЗГ РУ10|
|11|0CE00h|Palmira ext. byte|
|12|0C300h|FT245R port|
|13|8000h|ОЗУ вторые 32кб|
|14|0CA00h|VDP TMS9918A|
|15|0F700h|Страница контроллеров RK60k|

Линия 15 задает положения страницы контроллеров RK60k размером 256 байт. Контроллеры имеют следующие фиксированные относительные адреса:

|Номер|Контроллер|Адрес|
|-|-|-|
|0|FDC |0F700h; 1793 floppy disk controller|
|1|INTR|0F720h; 8259 interrupt controller   |
|2|PSG1|0F740h; 8253 first	                |
|3|PSG2|0F760h; 8253 second	      	        |
|4|PPI |0F780h; 8255 fist		                |
|5|PPI2|0F7A0h; 8255 second	            	  |
|6|DISP|0F7C0h; 8275 display adapter	      |
|7|DMA |0F7E0h; 8257 DMA chip	    	        |


Поскольку одна конфигурация занимает 512 байт в ОЗУ дешифратора, появляется возможность хранить 4 конфигурации и мгновенно переключать их битами 3 и 4 системного регистра.




