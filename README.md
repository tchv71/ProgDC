## Программируемый дешифратор (MMU) для Пальмиры

Прототипом послужил программируемый дешифратор для Радио 86-РК, описанный в журналах "Радио" 1994, №3-5. Общая идея конструктива - плата программируемого дешифратора вставляется в сокет процессора, а процессор (возможно, в виде z80card) вставляется в панельку на плате ПД. Дополнительные сигналы к/от платы Пальмиры выводятся на штырьковый разъем на правом краю платы ПД.

Внесены следующие усовершенствования:

1. Устранена зависимость от значений системного регистра при программировании устройства по адресу 0FFh. В оригинальном устройстве запись по адресу 0FFh меняла и значение системного регистра, и ОЗУ дешифратора. Это налагало ограничение на значения, которые можно записать в порт 0FFh и усложняло программирование. Теперь эти порты схемотехнически разделены - если было предварительное чтение из порта 0FFh, запись будет в системный регистр, в противном случае - в ОЗУ дешифратора.
2. Используются все биты ОЗУ дешифратора, старшие 4 бита используются для расширения адреса системного ОЗУ. Поддерживается до 512К системного ОЗУ. Поддерживается 64 (максимум 128) кбайта ПЗУ.
3. Бит 4 ОЗУ дешифратора более не используется как признак "только чтение", вместо него используется значение 3 номера линии устройства.
4. Поддерживается бит 0 байта расширения конфигурации Пальмиры, включающий теневое ОЗУ по адресам 0-7FFFh.
5. Поддерживается до 4-х конфигураций дешифратора, которые выбираются битами 4-3 системного регистра. Таким образом, для того, чтобы изменить конфигурацию памяти, нет необходимости менять её постранично, можно запрограммировать новую конфигурацию заранее, а потом мгновенно применить её одной запись в порт 0FFh.
6. Поддерживается процессор Z80 в формате z80-card. 580ВМ80А также поддерживается, совместно с системным контроллером 580ВК38
7. Вместо микросхемы КР537РУ10 применена IDC6116SA45P как более быстродействующая, изменены тайминги сигнала записи в нее для повышения надежности записи.

## Системный регистр (in/out 0FFh)

|Бит|Биты управления режимом|
|-|-|
|7||
|6||
|5||
|4|Биты выбора конфигурации|
|3|Биты выбора конфигурации|
|2|свободно|
|1|свободно|
|0|свободно|

Чтобы записать в системный регистр, надо сначала из него прочитать. Первая запись после чтения по адресу 0FFh будет в системный регистр, все последующие - в ОЗУ дешифратора (в режиме программирования) или в порт в рабочем режиме.
